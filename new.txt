import org.apache.flink.api.common.functions.AggregateFunction;
import org.apache.flink.streaming.api.datastream.DataStream;
import org.apache.flink.streaming.api.environment.StreamExecutionEnvironment;

public class EarlierAggregationExample {

    public static void main(String[] args) throws Exception {
        // Set up the execution environment
        StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();

        // Create a data stream
        DataStream<Integer> dataStream = env.fromElements(1, 2, 3, 4, 5);

        // Apply earlier aggregation
        DataStream<Integer> aggregatedStream = dataStream
                .keyBy(value -> "key") // Group by a constant key
                .aggregate(new SumAggregateFunction());

        // Print the results
        aggregatedStream.print();

        // Execute the Flink job
        env.execute("Earlier Aggregation Example");
    }

    // Custom AggregateFunction to calculate the sum
    public static class SumAggregateFunction implements AggregateFunction<Integer, Integer, Integer> {
        @Override
        public Integer createAccumulator() {
            return 0;
        }

        @Override
        public Integer add(Integer value, Integer accumulator) {
            return accumulator + value;
        }

        @Override
        public Integer getResult(Integer accumulator) {
            return accumulator;
        }

        @Override
        public Integer merge(Integer a, Integer b) {
            return a + b;
        }
    }
}
